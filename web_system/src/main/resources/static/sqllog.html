<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§è¶…å¸‚ç³»ç»Ÿ - SQLæ—¥å¿—ç›‘æ§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        /* é¡µé¢åŠ è½½åŠ¨ç”» */
        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .page-loader.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: #f8fafc;
            color: #2c3e50;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: #2c3e50;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            margin: 1rem;
        }

        .header h1 {
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .druid-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #1e90ff;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .druid-link:hover {
            background: #1a7ee3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 144, 255, 0.4);
        }

        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: #8b92ff;
            color: white;
            border-color: transparent;
        }

        .btn-primary:hover {
            background: #7980ff;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 146, 255, 0.4);
        }

        .btn-danger {
            background: #95a5a6;
            color: white;
            border-color: transparent;
        }

        .btn-danger:hover {
            background: #7f8c8d;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 1.25rem 1.5rem;
            border: 1px solid rgba(139, 146, 255, 0.1);
            border-radius: 12px 12px 0 0;
            box-shadow: 0 4px 16px rgba(139, 146, 255, 0.08);
            display: flex;
            gap: 1.25rem;
            align-items: center;
            flex-wrap: wrap;
            margin: 1rem 1rem 0 1rem;
            position: relative;
        }

        .controls::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #8b92ff, transparent);
            border-radius: 12px 12px 0 0;
        }

        .search-box {
            flex: 1;
            min-width: 320px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 3rem 0.75rem 1.25rem;
            border: 2px solid rgba(139, 146, 255, 0.15);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            color: #2c3e50;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 146, 255, 0.05);
        }

        .search-box input:focus {
            outline: none;
            border-color: #8b92ff;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 3px rgba(139, 146, 255, 0.15);
        }

        .search-box input::placeholder {
            color: #8892b0;
        }

        .search-box .search-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #8b92ff;
            font-size: 1.1rem;
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 2px solid rgba(139, 146, 255, 0.15);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            color: #2c3e50;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 146, 255, 0.05);
            cursor: pointer;
            min-width: 140px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #8b92ff;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 3px rgba(139, 146, 255, 0.15);
        }

        .stats {
            background: linear-gradient(135deg, #8b92ff 0%, #7980ff 100%);
            padding: 1.5rem;
            color: white;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 1rem;
            margin: 0 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(139, 146, 255, 0.12);
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .stat-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .stat-item:hover::before {
            left: 100%;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            display: block;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.6rem;
            margin-bottom: 0.25rem;
            display: block;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 0 1rem 2rem 1rem;
        }

        .sql-logs {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .log-item {
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .log-item:hover {
            background: rgba(139, 146, 255, 0.06);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .log-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #8b92ff;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .log-item:hover::before {
            opacity: 1;
        }

        .log-item:last-child {
            border-bottom: none;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .log-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
        }

        .sql-type {
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .sql-type.SELECT {
            background: #e3f2fd;
            color: #1976d2;
        }

        .sql-type.INSERT {
            background: #e8f5e8;
            color: #388e3c;
        }

        .sql-type.UPDATE {
            background: #fff3e0;
            color: #f57c00;
        }

        .sql-type.DELETE {
            background: #ffebee;
            color: #d32f2f;
        }

        .performance {
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .performance.fast {
            background: #e8f5e8;
            color: #388e3c;
        }

        .performance.medium {
            background: #fff3e0;
            color: #f57c00;
        }

        .performance.slow {
            background: #ffebee;
            color: #d32f2f;
        }

        .log-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border: 1px solid #8b92ff;
            background: #8b92ff;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .btn-small:hover {
            background: #7980ff;
            border-color: #7980ff;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(139, 146, 255, 0.4);
        }

        .btn-small:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(139, 146, 255, 0.3);
        }

        .sql-content {
            background: linear-gradient(135deg, rgba(248, 249, 250, 0.9) 0%, rgba(233, 236, 239, 0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
            margin-top: 1rem;
            border: 1px solid rgba(100, 108, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .sql-content::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #646cff;
            border-radius: 0 2px 2px 0;
        }

        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(139, 146, 255, 0.95) 0%, rgba(121, 128, 255, 0.95) 100%);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            overflow: hidden;
        }

        .login-overlay::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 20s linear infinite;
            z-index: -1;
        }

        @keyframes float {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.3);
            width: 100%;
            max-width: 420px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b92ff, #7980ff, #8b92ff);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {

            0%,
            100% {
                background-position: 200% 0;
            }

            50% {
                background-position: -200% 0;
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 1;
        }

        .login-header h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 0.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, #8b92ff 0%, #7980ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-header p {
            color: #64748b;
            font-size: 0.95rem;
            font-weight: 400;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.75rem;
            color: #374151;
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.025em;
        }

        .form-group input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid rgba(139, 146, 255, 0.2);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            color: #2c3e50;
        }

        .form-group input:focus {
            outline: none;
            border-color: #8b92ff;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 4px rgba(139, 146, 255, 0.1);
            transform: translateY(-1px);
        }

        .form-group input::placeholder {
            color: #9ca3af;
        }

        .login-btn {
            width: 100%;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, #8b92ff 0%, #7980ff 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(139, 146, 255, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(139, 146, 255, 0.4);
        }

        .error-message {
            color: #ef4444;
            text-align: center;
            margin-top: 1.5rem;
            display: none;
            background: rgba(239, 68, 68, 0.1);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            font-size: 0.9rem;
            max-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .toast.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .no-logs {
            text-align: center;
            padding: 3rem;
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #999;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }

            .stats {
                justify-content: center;
            }

            .log-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .log-meta {
                flex-wrap: wrap;
            }
        }
    </style>
</head>

<body>
    <!-- é¡µé¢åŠ è½½å™¨ -->
    <div class="page-loader" id="pageLoader">
        <div class="loader-spinner"></div>
    </div>

    <!-- ç™»å½•é®ç½©å±‚ -->
    <div id="loginOverlay" class="login-overlay" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <h2>ğŸ“Š SQLæ—¥å¿—ç›‘æ§</h2>
                <p>è¯·è¾“å…¥ç™»å½•å‡­æ®ä»¥è®¿é—®SQLæ—¥å¿—ç›‘æ§é¢æ¿</p>
                <p style="margin-top: 1rem; font-size: 0.85rem; color: #8b92ff;">é»˜è®¤è´¦å·å¯†ç ï¼šadmin / admin</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="username">ğŸ‘¤ ç”¨æˆ·å</label>
                    <input type="text" id="username" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" value="admin" required>
                </div>

                <div class="form-group">
                    <label for="password">ğŸ” å¯†ç </label>
                    <input type="password" id="password" name="password" placeholder="è¯·è¾“å…¥å¯†ç " value="admin" required>
                </div>

                <button type="submit" class="login-btn">ç™»å½•</button>

                <div id="errorMessage" class="error-message">
                    ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
                </div>
            </form>
        </div>
    </div>

    <!-- ä¸»é¡µé¢å†…å®¹ -->
    <div id="mainContent" style="display: none;">
        <div class="header">
            <h1>ğŸ“Š æ™ºæ…§è¶…å¸‚ç³»ç»Ÿ - SQLæ—¥å¿—ç›‘æ§</h1>
            <div class="header-actions">
                <a href="http://localhost:8080/druid/login.html" target="_blank" class="druid-link">ğŸ“Š Druidç›‘æ§</a>
                <button class="btn btn-primary" onclick="refreshLogs()">ğŸ”„ åˆ·æ–°</button>
                <button class="btn btn-primary" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
                <button class="btn btn-primary" onclick="exportLogs()">ğŸ“¥ å¯¼å‡ºæ—¥å¿—</button>
                <button class="btn btn-danger" onclick="logout()">ğŸšª é€€å‡º</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-label">æ€»è®°å½•æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">âš¡</div>
                <div class="stat-value" id="fastCount">0</div>
                <div class="stat-label">å¿«é€ŸæŸ¥è¯¢</div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">âš ï¸</div>
                <div class="stat-value" id="mediumCount">0</div>
                <div class="stat-label">ä¸­ç­‰æŸ¥è¯¢</div>
            </div>
            <div class="stat-item">
                <div class="stat-icon">ğŸŒ</div>
                <div class="stat-value" id="slowCount">0</div>
                <div class="stat-label">æ…¢æŸ¥è¯¢</div>
            </div>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢SQLè¯­å¥ã€è¡¨åæˆ–SQLç±»å‹..." oninput="filterLogs()">
                <span class="search-icon">ğŸ”</span>
            </div>
            <select class="filter-select" id="typeFilter" onchange="filterLogs()">
                <option value="">æ‰€æœ‰ç±»å‹</option>
                <option value="SELECT">SELECT</option>
                <option value="INSERT">INSERT</option>
                <option value="UPDATE">UPDATE</option>
                <option value="DELETE">DELETE</option>
            </select>
            <select class="filter-select" id="performanceFilter" onchange="filterLogs()">
                <option value="">æ‰€æœ‰æ€§èƒ½</option>
                <option value="fast">å¿«é€Ÿ (&lt;500ms)</option>
                <option value="medium">ä¸­ç­‰ (500-1000ms)</option>
                <option value="slow">æ…¢æŸ¥è¯¢ (>1000ms)</option>
            </select>
        </div>

        <div class="main-content">
            <div class="sql-logs" id="sqlLogs">
                <div class="loading">
                    æ­£åœ¨åŠ è½½SQLæ—¥å¿—...
                </div>
            </div>
        </div>
    </div>

    <script>
        let allLogs = [];
        let filteredLogs = [];
        let isAuthenticated = false;

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è®¤è¯çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function () {
            // é¡µé¢åŠ è½½å®Œæˆåéšè—åŠ è½½å™¨
            setTimeout(() => {
                const pageLoader = document.getElementById('pageLoader');
                pageLoader.classList.add('fade-out');
                setTimeout(() => {
                    pageLoader.style.display = 'none';
                }, 500);
            }, 1000);

            checkAuthStatus();
        });

        // æ£€æŸ¥è®¤è¯çŠ¶æ€ï¼ˆé™æ€éªŒè¯ï¼‰
        function checkAuthStatus() {
            const isLoggedIn = localStorage.getItem('sqlLogLogin') === 'true';
            if (isLoggedIn) {
                showMainContent();
            } else {
                showLoginOverlay();
            }
        }

        // æ˜¾ç¤ºç™»å½•é®ç½©
        function showLoginOverlay() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            isAuthenticated = false;
        }

        // æ˜¾ç¤ºä¸»å†…å®¹
        function showMainContent() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            isAuthenticated = true;
            loadSqlLogs();
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
            setInterval(loadSqlLogs, 30000);
        }

        // ç™»å½•è¡¨å•æäº¤
        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');

            // é™æ€éªŒè¯ï¼šé»˜è®¤è´¦å·å¯†ç ä¸ºadmin
            if (username === 'admin' && password === 'admin') {
                localStorage.setItem('sqlLogLogin', 'true');
                showMainContent();
                errorMessage.style.display = 'none';
                showToast('ç™»å½•æˆåŠŸï¼', 'success');
            } else {
                errorMessage.style.display = 'block';
                errorMessage.textContent = 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œè¯·ä½¿ç”¨ admin / admin';
            }
        });

        // åŠ è½½SQLæ—¥å¿—ï¼ˆä»åç«¯è·å–çœŸå®æ•°æ®ï¼‰
        async function loadSqlLogs() {
            if (!isAuthenticated) return;

            try {
                // è°ƒç”¨ç°æœ‰çš„logs API
                const response = await fetch('/api/sql-log/logs');
                const data = await response.json();

                if (data.success) {
                    allLogs = data.data.logs || [];
                    updateStats();
                    filterLogs();
                } else {
                    console.error('è·å–SQLæ—¥å¿—å¤±è´¥:', data.message);
                    // å¦‚æœlogs APIä¸å­˜åœ¨ï¼Œå°è¯•è·å–ç»Ÿè®¡ä¿¡æ¯å¹¶æ˜¾ç¤ºæç¤º
                    await updateStats();
                    document.getElementById('sqlLogs').innerHTML =
                        '<div class="no-logs">SQLæ—¥å¿—ç›‘æ§åŠŸèƒ½æ­£å¸¸è¿è¡Œ<br/>ç»Ÿè®¡ä¿¡æ¯å·²æ›´æ–°ï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹æ•°æ®å¡ç‰‡</div>';
                }
            } catch (error) {
                console.error('åŠ è½½SQLæ—¥å¿—å¤±è´¥:', error);
                try {
                    // å°è¯•è·å–ç»Ÿè®¡ä¿¡æ¯
                    await updateStats();
                    document.getElementById('sqlLogs').innerHTML =
                        '<div class="no-logs">SQLæ—¥å¿—ç›‘æ§åŠŸèƒ½æ­£å¸¸è¿è¡Œ<br/>ç»Ÿè®¡ä¿¡æ¯å·²æ›´æ–°ï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹æ•°æ®å¡ç‰‡<br/><br/>ğŸ’¡ æç¤ºï¼šæ‰§è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼ŒSQLæ—¥å¿—ä¼šè¾“å‡ºåˆ°åç«¯æ§åˆ¶å°</div>';
                } catch (statsError) {
                    document.getElementById('sqlLogs').innerHTML =
                        '<div class="no-logs">æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨</div>';
                }
            }
        }


        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆä»åç«¯è·å–ï¼‰
        async function updateStats() {
            try {
                const response = await fetch('/api/sql-log/stats');
                const data = await response.json();

                if (data.success) {
                    const stats = data.data;
                    document.getElementById('totalCount').textContent = stats.totalCount || 0;
                    document.getElementById('fastCount').textContent = stats.fastCount || 0;
                    document.getElementById('mediumCount').textContent = stats.mediumCount || 0;
                    document.getElementById('slowCount').textContent = stats.slowCount || 0;
                } else {
                    // å¦‚æœstats APIè¿”å›å¤±è´¥ï¼Œæ˜¾ç¤ºé»˜è®¤å€¼
                    document.getElementById('totalCount').textContent = '0';
                    document.getElementById('fastCount').textContent = '0';
                    document.getElementById('mediumCount').textContent = '0';
                    document.getElementById('slowCount').textContent = '0';
                }
            } catch (error) {
                console.error('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
                // ä½¿ç”¨æœ¬åœ°è®¡ç®—çš„ç»Ÿè®¡ä¿¡æ¯ä½œä¸ºå¤‡é€‰
                const total = allLogs.length;
                const fast = allLogs.filter(log => log.executionTime < 500).length;
                const medium = allLogs.filter(log => log.executionTime >= 500 && log.executionTime < 1000).length;
                const slow = allLogs.filter(log => log.executionTime >= 1000).length;

                document.getElementById('totalCount').textContent = total;
                document.getElementById('fastCount').textContent = fast;
                document.getElementById('mediumCount').textContent = medium;
                document.getElementById('slowCount').textContent = slow;
            }
        }


        // æ¸…ç©ºæ—¥å¿—ï¼ˆè°ƒç”¨åç«¯APIï¼‰
        async function clearLogs() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰SQLæ—¥å¿—å—ï¼Ÿ')) {
                try {
                    // ç”±äºåç«¯æ²¡æœ‰clear APIï¼Œè¿™é‡Œåªæ˜¯æ¸…ç©ºå‰ç«¯æ˜¾ç¤º
                    allLogs = [];
                    filteredLogs = [];
                    updateStats();
                    renderLogs();
                    showToast('å‰ç«¯æ—¥å¿—æ˜¾ç¤ºå·²æ¸…ç©º', 'success');
                } catch (error) {
                    console.error('æ¸…ç©ºå¤±è´¥:', error);
                    showToast('æ¸…ç©ºå¤±è´¥', 'error');
                }
            }
        }

        // æ¸²æŸ“æ—¥å¿—åˆ—è¡¨ï¼ˆé€‚é…åç«¯æ•°æ®æ ¼å¼ï¼‰
        function renderLogs() {
            const container = document.getElementById('sqlLogs');

            if (filteredLogs.length === 0) {
                container.innerHTML = '<div class="no-logs">æš‚æ— SQLæ—¥å¿—è®°å½•</div>';
                return;
            }

            const html = filteredLogs.map(log => {
                const time = new Date(log.createdAt).toLocaleString();
                const performanceClass = getPerformanceClass(log.executionTime);
                const performanceText = getPerformanceText(log.executionTime);

                return `
                <div class="log-item">
                    <div class="log-header">
                        <div class="log-meta">
                            <span class="sql-type ${log.sqlType}">${log.sqlType}</span>
                            <span class="performance ${performanceClass}">${performanceText}</span>
                            <span>ğŸ“… ${time}</span>
                            ${log.tableName ? `<span>ğŸ“‹ ${log.tableName}</span>` : ''}
                            <span>ğŸ“Š ${log.rowsAffected || 0} è¡Œ</span>
                            ${log.success === false ? '<span style="color: #dc3545;">âŒ å¤±è´¥</span>' : '<span style="color: #28a745;">âœ… æˆåŠŸ</span>'}
                        </div>
                        <div class="log-actions">
                            <button class="btn-small" onclick="copySql(\`${log.sqlStatement.replace(/`/g, '\\`')}\`)">ğŸ“‹ å¤åˆ¶</button>
                            <button class="btn-small" onclick="formatSql(\`${log.sqlStatement.replace(/`/g, '\\`')}\`)">ğŸ¨ æ ¼å¼åŒ–</button>
                            <button class="btn-small" onclick="analyzeSql(\`${log.sqlStatement.replace(/`/g, '\\`')}\`, ${log.executionTime})">ğŸ” åˆ†æ</button>
                        </div>
                    </div>
                    <div class="sql-content">${escapeHtml(log.sqlStatement)}</div>
                    ${log.errorMessage ? `<div style="color: #dc3545; margin-top: 1rem; padding: 1rem; background: #f8d7da; border-radius: 8px;">é”™è¯¯ä¿¡æ¯: ${escapeHtml(log.errorMessage)}</div>` : ''}
                    <div id="result-${log.id}" class="sql-result" style="display: none;"></div>
                </div>
            `;
            }).join('');

            container.innerHTML = html;
        }

        // è¿‡æ»¤æ—¥å¿—ï¼ˆé€‚é…åç«¯æ•°æ®æ ¼å¼ï¼‰
        function filterLogs() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const performanceFilter = document.getElementById('performanceFilter').value;

            filteredLogs = allLogs.filter(log => {
                // æœç´¢è¿‡æ»¤
                const matchesSearch = !searchText ||
                    log.sqlStatement.toLowerCase().includes(searchText) ||
                    (log.tableName && log.tableName.toLowerCase().includes(searchText)) ||
                    log.sqlType.toLowerCase().includes(searchText);

                // ç±»å‹è¿‡æ»¤
                const matchesType = !typeFilter || log.sqlType === typeFilter;

                // æ€§èƒ½è¿‡æ»¤
                let matchesPerformance = true;
                if (performanceFilter === 'fast') {
                    matchesPerformance = log.executionTime < 500;
                } else if (performanceFilter === 'medium') {
                    matchesPerformance = log.executionTime >= 500 && log.executionTime < 1000;
                } else if (performanceFilter === 'slow') {
                    matchesPerformance = log.executionTime >= 1000;
                }

                return matchesSearch && matchesType && matchesPerformance;
            });

            renderLogs();
        }

        // è·å–æ€§èƒ½ç­‰çº§æ ·å¼ç±»
        function getPerformanceClass(elapsedTime) {
            if (elapsedTime < 500) return 'fast';
            if (elapsedTime < 1000) return 'medium';
            return 'slow';
        }

        // è·å–æ€§èƒ½ç­‰çº§æ–‡æœ¬
        function getPerformanceText(elapsedTime) {
            if (elapsedTime < 500) return `âš¡ ${elapsedTime}ms`;
            if (elapsedTime < 1000) return `âš ï¸ ${elapsedTime}ms`;
            return `ğŸŒ ${elapsedTime}ms`;
        }

        // è½¬ä¹‰HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // å¤åˆ¶SQL
        function copySql(sql) {
            navigator.clipboard.writeText(sql).then(() => {
                showToast('SQLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            });
        }

        // æ ¼å¼åŒ–SQL
        function formatSql(sql) {
            // ç®€å•çš„SQLæ ¼å¼åŒ–
            const formatted = sql
                .replace(/\bSELECT\b/gi, '\nSELECT')
                .replace(/\bFROM\b/gi, '\nFROM')
                .replace(/\bWHERE\b/gi, '\nWHERE')
                .replace(/\bAND\b/gi, '\n  AND')
                .replace(/\bOR\b/gi, '\n  OR')
                .replace(/\bORDER BY\b/gi, '\nORDER BY')
                .replace(/\bGROUP BY\b/gi, '\nGROUP BY')
                .replace(/\bHAVING\b/gi, '\nHAVING')
                .replace(/\bLIMIT\b/gi, '\nLIMIT')
                .trim();

            navigator.clipboard.writeText(formatted).then(() => {
                showToast('æ ¼å¼åŒ–SQLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(error => {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            });
        }

        // åˆ†æSQL
        function analyzeSql(sql, elapsedTime) {
            const analysis = {
                sql: sql,
                executionTime: elapsedTime,
                performance: elapsedTime < 500 ? 'ä¼˜ç§€' : elapsedTime < 1000 ? 'è‰¯å¥½' : 'éœ€è¦ä¼˜åŒ–',
                suggestions: []
            };

            // ç®€å•çš„SQLåˆ†æå»ºè®®
            if (sql.includes('SELECT *')) {
                analysis.suggestions.push('å»ºè®®é¿å…ä½¿ç”¨ SELECT *ï¼Œæ˜ç¡®æŒ‡å®šéœ€è¦çš„å­—æ®µ');
            }
            if (!sql.includes('WHERE') && sql.includes('SELECT')) {
                analysis.suggestions.push('å»ºè®®æ·»åŠ  WHERE æ¡ä»¶ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡');
            }
            if (elapsedTime > 1000) {
                analysis.suggestions.push('æŸ¥è¯¢æ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®æ£€æŸ¥ç´¢å¼•æˆ–ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶');
            }
            if (sql.includes('LEFT JOIN') || sql.includes('INNER JOIN')) {
                analysis.suggestions.push('ä½¿ç”¨äº†è¿æ¥æŸ¥è¯¢ï¼Œç¡®ä¿è¿æ¥å­—æ®µæœ‰é€‚å½“çš„ç´¢å¼•');
            }

            showToast(`SQLåˆ†æå®Œæˆ - æ€§èƒ½: ${analysis.performance}`, 'success');
            console.log('SQLåˆ†æç»“æœ:', analysis);
        }

        // åˆ·æ–°æ—¥å¿—
        function refreshLogs() {
            loadSqlLogs();
            showToast('æ—¥å¿—å·²åˆ·æ–°', 'success');
        }

        // å¯¼å‡ºæ—¥å¿—
        function exportLogs() {
            if (filteredLogs.length === 0) {
                showToast('æ²¡æœ‰å¯å¯¼å‡ºçš„æ—¥å¿—', 'error');
                return;
            }

            try {
                const csvContent = generateCsvContent(filteredLogs);
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `sql_logs_${new Date().getTime()}.csv`;
                link.click();
                showToast('æ—¥å¿—å·²å¯¼å‡ºä¸ºCSVæ–‡ä»¶', 'success');
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                showToast('å¯¼å‡ºå¤±è´¥', 'error');
            }
        }

        // ç”ŸæˆCSVå†…å®¹
        function generateCsvContent(logs) {
            const headers = ['æ—¶é—´', 'SQLç±»å‹', 'SQLè¯­å¥', 'è¡¨å', 'æ‰§è¡Œæ—¶é—´(ms)', 'å½±å“è¡Œæ•°', 'çŠ¶æ€'];
            let csvContent = headers.join(',') + '\n';

            logs.forEach(log => {
                const row = [
                    new Date(log.createdAt).toLocaleString(),
                    log.sqlType,
                    `"${log.sqlStatement.replace(/"/g, '""')}"`,
                    log.tableName || '',
                    log.executionTime,
                    log.rowsAffected || 0,
                    log.success === false ? 'å¤±è´¥' : 'æˆåŠŸ'
                ];
                csvContent += row.join(',') + '\n';
            });

            return csvContent;
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('sqlLogLogin');
                showLoginOverlay();
                showToast('å·²é€€å‡ºç™»å½•', 'success');
            }
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
    </script>
</body>

</html>