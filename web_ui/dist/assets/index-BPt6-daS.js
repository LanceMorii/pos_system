import{d as z,r as v,k as I,c as y,e as a,w as e,g as m,E as b,o as u,b as s,C as S,D as _,l as i,Z as w,a2 as C,a3 as x,U as N,y as c,h as f,J,_ as L}from"./index-DhDhwFZx.js";import{s as B}from"./request-Bb0hX5IM.js";const P={class:"system-status-container"},U={class:"card-header"},Z={class:"status-grid"},j={class:"status-content"},q={class:"status-icon"},G={class:"status-info"},H={key:0,class:"status-details"},K={class:"status-content"},Q={class:"status-icon"},R={class:"status-info"},W={key:0,class:"status-details"},X={class:"status-content"},Y={class:"status-icon"},$={class:"status-info"},ss={key:0,class:"status-details"},as={class:"system-info"},es=z({__name:"index",setup(ts){const k=v(!1),E=v(!0),D=v(""),g=v("检查中..."),o=v({status:"loading",message:"检查中...",data:null}),n=v({status:"loading",message:"检查中...",data:null}),d=v({status:"loading",message:"检查中...",data:null}),M=async()=>{try{const t=await B({url:"/test/database-status",method:"get"});t.code===200?o.value={status:"success",message:"数据库连接正常",data:t.data}:o.value={status:"error",message:t.message||"数据库连接失败",data:null}}catch(t){o.value={status:"error",message:"数据库连接异常: "+t.message,data:null}}},A=async()=>{try{const t=await B({url:"/test/create-order",method:"post"});t.code===200?n.value={status:"success",message:"订单系统正常",data:t.data}:n.value={status:"error",message:t.message||"订单系统异常",data:null}}catch(t){n.value={status:"error",message:"订单系统异常: "+t.message,data:null}}},F=async()=>{try{const t=await B({url:"/cashier/health",method:"get"});t.code===200?d.value={status:"success",message:"收银系统正常",data:t.stats}:d.value={status:"error",message:t.message||"收银系统异常",data:null}}catch(t){d.value={status:"error",message:"收银系统异常: "+t.message,data:null}}},V=async()=>{k.value=!0,o.value={status:"loading",message:"检查中...",data:null},n.value={status:"loading",message:"检查中...",data:null},d.value={status:"loading",message:"检查中...",data:null};try{await Promise.all([M(),A(),F()]),[o.value,n.value,d.value].every(l=>l.status==="success")?(g.value="系统正常",b.success("系统状态检查完成，所有模块正常")):(g.value="部分异常",b.warning("系统状态检查完成，部分模块异常")),D.value=new Date().toLocaleString()}catch{g.value="检查失败",b.error("系统状态检查失败")}finally{k.value=!1}};return I(()=>{V()}),(t,l)=>{const r=m("el-icon"),O=m("el-button"),p=m("el-card"),h=m("el-descriptions-item"),T=m("el-descriptions");return u(),y("div",P,[a(p,{shadow:"never"},{header:e(()=>[s("div",U,[l[1]||(l[1]=s("span",null,"系统状态检查",-1)),a(O,{type:"primary",onClick:V,loading:k.value},{default:e(()=>[a(r,null,{default:e(()=>[a(i(J))]),_:1}),l[0]||(l[0]=f(" 刷新状态 "))]),_:1,__:[0]},8,["loading"])])]),default:e(()=>[s("div",Z,[a(p,{shadow:"hover",class:S(["status-card",o.value.status])},{default:e(()=>[s("div",j,[s("div",q,[o.value.status==="success"?(u(),_(r,{key:0},{default:e(()=>[a(i(w))]),_:1})):o.value.status==="error"?(u(),_(r,{key:1},{default:e(()=>[a(i(C))]),_:1})):(u(),_(r,{key:2},{default:e(()=>[a(i(x))]),_:1}))]),s("div",G,[l[2]||(l[2]=s("h3",null,"数据库连接",-1)),s("p",null,c(o.value.message),1),o.value.data?(u(),y("div",H,[s("span",null,"今日订单: "+c(o.value.data.todayOrders||0),1),s("span",null,"今日销售: ¥"+c((o.value.data.todaySales||0).toFixed(2)),1)])):N("",!0)])])]),_:1},8,["class"]),a(p,{shadow:"hover",class:S(["status-card",n.value.status])},{default:e(()=>[s("div",K,[s("div",Q,[n.value.status==="success"?(u(),_(r,{key:0},{default:e(()=>[a(i(w))]),_:1})):n.value.status==="error"?(u(),_(r,{key:1},{default:e(()=>[a(i(C))]),_:1})):(u(),_(r,{key:2},{default:e(()=>[a(i(x))]),_:1}))]),s("div",R,[l[3]||(l[3]=s("h3",null,"订单系统",-1)),s("p",null,c(n.value.message),1),n.value.data?(u(),y("div",W,[s("span",null,"订单号: "+c(n.value.data.orderNo),1),s("span",null,"金额: ¥"+c((n.value.data.finalAmount||0).toFixed(2)),1)])):N("",!0)])])]),_:1},8,["class"]),a(p,{shadow:"hover",class:S(["status-card",d.value.status])},{default:e(()=>[s("div",X,[s("div",Y,[d.value.status==="success"?(u(),_(r,{key:0},{default:e(()=>[a(i(w))]),_:1})):d.value.status==="error"?(u(),_(r,{key:1},{default:e(()=>[a(i(C))]),_:1})):(u(),_(r,{key:2},{default:e(()=>[a(i(x))]),_:1}))]),s("div",$,[l[4]||(l[4]=s("h3",null,"收银系统",-1)),s("p",null,c(d.value.message),1),d.value.data?(u(),y("div",ss,[s("span",null,"商品数: "+c(d.value.data.productCount||0),1),s("span",null,"分类数: "+c(d.value.data.categoryCount||0),1)])):N("",!0)])])]),_:1},8,["class"])]),s("div",as,[a(T,{title:"系统信息",column:2,border:""},{default:e(()=>[a(h,{label:"系统版本"},{default:e(()=>l[5]||(l[5]=[f("v1.0.0")])),_:1,__:[5]}),a(h,{label:"数据库模式"},{default:e(()=>[f(c(E.value?"生产模式":"开发模式"),1)]),_:1}),a(h,{label:"最后检查时间"},{default:e(()=>[f(c(D.value),1)]),_:1}),a(h,{label:"系统状态"},{default:e(()=>[f(c(g.value),1)]),_:1})]),_:1})])]),_:1})])}}}),os=L(es,[["__scopeId","data-v-94b92b5b"]]);export{os as default};
