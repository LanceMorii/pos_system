import{a1 as m,r as f}from"./index-DhDhwFZx.js";import{s}from"./request-Bb0hX5IM.js";function p(r){return s({url:"/auth/login",method:"post",data:r})}function g(r){return s({url:"/auth/register",method:"post",data:r})}function S(){return s({url:"/profile/info",method:"get"})}function U(){return s({url:"/profile/info",method:"get"})}function v(r){return s({url:"/profile/update",method:"put",data:r})}function k(r){return s({url:"/profile/password",method:"put",data:r})}const w=m("user",()=>{const r=f({id:"",username:"",realName:"",phone:"",email:"",role:"",avatar:"",permissions:[]}),n=t=>{r.value=t},a=()=>{r.value={id:"",username:"",realName:"",phone:"",email:"",role:"",avatar:"",permissions:[]}},u=async t=>{try{const o=await p(t),{data:e}=o;return localStorage.setItem("token",e.token),n(e.user),o;localStorage.setItem("token",e.token);const l={id:e.userId.toString(),username:e.username,realName:e.realName,phone:e.phone||"",email:e.email||"",role:e.role,avatar:e.avatar||"",permissions:e.permissions||[]};return n(l),localStorage.setItem("userInfo",JSON.stringify(l)),o}catch(o){throw o}},c=async t=>{try{return await g(t)}catch(o){throw o}},i=()=>{a(),localStorage.removeItem("token"),localStorage.removeItem("userInfo")};return{userInfo:r,setUserInfo:n,clearUserInfo:a,login:u,register:c,logout:i,initUserInfo:()=>{const t=localStorage.getItem("token"),o=localStorage.getItem("userInfo");if(t&&o)try{const e=JSON.parse(o);n(e)}catch(e){console.error("解析用户信息失败:",e),i()}}}});export{U as a,v as b,k as c,S as g,w as u};
