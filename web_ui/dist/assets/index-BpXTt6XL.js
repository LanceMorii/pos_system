import{d as Z,a as T,r as x,k as ee,c as ae,e as a,w as o,g as u,o as k,b as V,h as v,y as C,l as L,S as le,Q as te,D as A,U as B,E as y,A as E,_ as oe}from"./index-DhDhwFZx.js";const re={class:"user-container"},se={class:"card-header"},ne={class:"header-buttons"},ie={class:"search-section"},de={class:"pagination-section"},ue={class:"dialog-footer"},me=Z({__name:"index",setup(pe){const d=T({username:"",realName:"",role:"",status:""}),f=T({currentPage:1,pageSize:20,total:0}),p=x([{id:"1",username:"admin",realName:"系统管理员",role:"admin",phone:"13800138000",email:"admin@supermarket.com",lastLoginTime:"2025-01-22 14:30:25",status:"active",createTime:"2024-01-01 09:00:00"},{id:"2",username:"cashier01",realName:"张三",role:"cashier",phone:"13800138001",email:"zhangsan@supermarket.com",lastLoginTime:"2025-01-22 14:25:18",status:"active",createTime:"2024-02-15 10:30:00"},{id:"3",username:"cashier02",realName:"李四",role:"cashier",phone:"13800138002",email:"lisi@supermarket.com",lastLoginTime:"2025-01-22 14:20:45",status:"active",createTime:"2024-03-10 11:15:00"},{id:"4",username:"warehouse01",realName:"王五",role:"warehouse",phone:"13800138003",email:"wangwu@supermarket.com",lastLoginTime:"2025-01-22 09:15:30",status:"active",createTime:"2024-04-20 14:45:00"},{id:"5",username:"cashier03",realName:"赵六",role:"cashier",phone:"13800138004",email:"zhaoliu@supermarket.com",lastLoginTime:"2025-01-21 18:30:00",status:"disabled",createTime:"2024-05-08 16:20:00"}]),U=r=>({admin:"管理员",cashier:"收银员",warehouse:"库管员"})[r]||"未知",$=r=>({admin:"danger",cashier:"primary",warehouse:"warning"})[r]||"info",h=x(!1),b=x("add"),w=x(),l=T({id:"",username:"",realName:"",role:"cashier",phone:"",email:"",password:"",confirmPassword:"",statusActive:!0}),D={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:(r,e,m)=>{e===""?m(new Error("请输入密码")):(l.confirmPassword!==""&&w.value.validateField("confirmPassword"),m())},trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(r,e,m)=>{e===""?m(new Error("请再次输入密码")):e!==l.password?m(new Error("两次输入密码不一致")):m()},trigger:"blur"}]},P=()=>{l.id="",l.username="",l.realName="",l.role="cashier",l.phone="",l.email="",l.password="",l.confirmPassword="",l.statusActive=!0,w.value&&w.value.resetFields()},N=()=>{console.log("搜索用户",d),f.currentPage=1},R=()=>{d.username="",d.realName="",d.role="",d.status="",N()},M=()=>{b.value="add",P(),h.value=!0},q=r=>{b.value="edit",P(),l.id=r.id,l.username=r.username,l.realName=r.realName,l.role=r.role,l.phone=r.phone,l.email=r.email,l.statusActive=r.status==="active",h.value=!0},j=()=>{w.value&&w.value.validate(r=>{if(r){if(b.value==="add"){const e={id:String(p.value.length+1),username:l.username,realName:l.realName,role:l.role,phone:l.phone,email:l.email,lastLoginTime:"-",status:l.statusActive?"active":"disabled",createTime:new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")};p.value.unshift(e),y.success("用户添加成功")}else{const e=p.value.findIndex(m=>m.id===l.id);e!==-1&&(p.value[e].realName=l.realName,p.value[e].role=l.role,p.value[e].phone=l.phone,p.value[e].email=l.email,p.value[e].status=l.statusActive?"active":"disabled",y.success("用户信息更新成功"))}h.value=!1,f.total=p.value.length}else return!1})},I=r=>{E.confirm(`确认重置用户 "${r.realName}" 的密码吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{y.success("密码重置成功，新密码为：123456")}).catch(()=>{})},O=r=>{const e=r.status==="active"?"禁用":"启用";E.confirm(`确认${e}用户 "${r.realName}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{r.status=r.status==="active"?"disabled":"active",y.success(`${e}成功`)}).catch(()=>{})},Q=r=>{f.pageSize=r,N()},G=r=>{f.currentPage=r,N()},H=()=>{try{const r=p.value.map(i=>({用户ID:i.id,用户名:i.username,真实姓名:i.realName,角色:U(i.role),手机号:i.phone,邮箱:i.email,最后登录:i.lastLoginTime,状态:i.status==="active"?"正常":"禁用",创建时间:i.createTime})),m=[["用户ID","用户名","真实姓名","角色","手机号","邮箱","最后登录","状态","创建时间"].join(","),...r.map(i=>Object.values(i).join(","))].join(`
`),g=new Blob(["\uFEFF"+m],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(g),c=new Date().toISOString().split("T")[0];s.setAttribute("href",n),s.setAttribute("download",`用户数据_${c}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),y.success("用户数据导出成功")}catch(r){console.error("导出失败:",r),y.error("导出失败，请重试")}};return ee(()=>{f.total=p.value.length}),(r,e)=>{const m=u("el-icon"),g=u("el-button"),s=u("el-input"),n=u("el-form-item"),c=u("el-option"),i=u("el-select"),S=u("el-form"),_=u("el-table-column"),z=u("el-tag"),J=u("el-table"),K=u("el-pagination"),W=u("el-card"),X=u("el-switch"),Y=u("el-dialog");return k(),ae("div",re,[a(W,{shadow:"never",class:"main-card"},{header:o(()=>[V("div",se,[e[18]||(e[18]=V("span",{class:"header-title"},"用户管理",-1)),V("div",ne,[a(g,{type:"success",onClick:H},{default:o(()=>[a(m,null,{default:o(()=>[a(L(le))]),_:1}),e[16]||(e[16]=v(" 导出用户 "))]),_:1,__:[16]}),a(g,{type:"primary",onClick:M},{default:o(()=>[a(m,null,{default:o(()=>[a(L(te))]),_:1}),e[17]||(e[17]=v(" 新增用户 "))]),_:1,__:[17]})])])]),default:o(()=>[V("div",ie,[a(S,{model:d,inline:""},{default:o(()=>[a(n,{label:"用户名"},{default:o(()=>[a(s,{modelValue:d.username,"onUpdate:modelValue":e[0]||(e[0]=t=>d.username=t),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{label:"真实姓名"},{default:o(()=>[a(s,{modelValue:d.realName,"onUpdate:modelValue":e[1]||(e[1]=t=>d.realName=t),placeholder:"请输入真实姓名",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{label:"角色"},{default:o(()=>[a(i,{modelValue:d.role,"onUpdate:modelValue":e[2]||(e[2]=t=>d.role=t),placeholder:"请选择角色",clearable:""},{default:o(()=>[a(c,{label:"全部",value:""}),a(c,{label:"管理员",value:"admin"}),a(c,{label:"收银员",value:"cashier"}),a(c,{label:"库管员",value:"warehouse"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"状态"},{default:o(()=>[a(i,{modelValue:d.status,"onUpdate:modelValue":e[3]||(e[3]=t=>d.status=t),placeholder:"请选择状态",clearable:""},{default:o(()=>[a(c,{label:"全部",value:""}),a(c,{label:"正常",value:"active"}),a(c,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:o(()=>[a(g,{type:"primary",onClick:N},{default:o(()=>e[19]||(e[19]=[v("查询")])),_:1,__:[19]}),a(g,{onClick:R},{default:o(()=>e[20]||(e[20]=[v("重置")])),_:1,__:[20]})]),_:1})]),_:1},8,["model"])]),a(J,{data:p.value,border:"",style:{width:"100%"}},{default:o(()=>[a(_,{prop:"id",label:"用户ID",width:"80"}),a(_,{prop:"username",label:"用户名",width:"120"}),a(_,{prop:"realName",label:"真实姓名",width:"120"}),a(_,{prop:"role",label:"角色",width:"100"},{default:o(t=>[a(z,{type:$(t.row.role)},{default:o(()=>[v(C(U(t.row.role)),1)]),_:2},1032,["type"])]),_:1}),a(_,{prop:"phone",label:"手机号",width:"120"}),a(_,{prop:"email",label:"邮箱",width:"180"}),a(_,{prop:"lastLoginTime",label:"最后登录",width:"150"}),a(_,{prop:"status",label:"状态",width:"80"},{default:o(t=>[a(z,{type:t.row.status==="active"?"success":"danger"},{default:o(()=>[v(C(t.row.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(_,{prop:"createTime",label:"创建时间",width:"150"}),a(_,{label:"操作",width:"240",fixed:"right"},{default:o(t=>[a(g,{link:"",type:"primary",onClick:F=>q(t.row)},{default:o(()=>e[21]||(e[21]=[v("编辑")])),_:2,__:[21]},1032,["onClick"]),a(g,{link:"",type:"warning",onClick:F=>I(t.row)},{default:o(()=>e[22]||(e[22]=[v("密码")])),_:2,__:[22]},1032,["onClick"]),a(g,{link:"",type:t.row.status==="active"?"danger":"success",onClick:F=>O(t.row)},{default:o(()=>[v(C(t.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"]),V("div",de,[a(K,{"current-page":f.currentPage,"onUpdate:currentPage":e[4]||(e[4]=t=>f.currentPage=t),"page-size":f.pageSize,"onUpdate:pageSize":e[5]||(e[5]=t=>f.pageSize=t),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1}),a(Y,{modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=t=>h.value=t),title:b.value==="add"?"新增用户":"编辑用户",width:"500px","destroy-on-close":""},{footer:o(()=>[V("div",ue,[a(g,{onClick:e[14]||(e[14]=t=>h.value=!1)},{default:o(()=>e[23]||(e[23]=[v("取消")])),_:1,__:[23]}),a(g,{type:"primary",onClick:j},{default:o(()=>e[24]||(e[24]=[v("确认")])),_:1,__:[24]})])]),default:o(()=>[a(S,{ref_key:"userFormRef",ref:w,model:l,rules:D,"label-width":"100px","label-position":"right"},{default:o(()=>[a(n,{label:"用户名",prop:"username"},{default:o(()=>[a(s,{modelValue:l.username,"onUpdate:modelValue":e[6]||(e[6]=t=>l.username=t),placeholder:"请输入用户名",disabled:b.value==="edit","prefix-icon":"User"},null,8,["modelValue","disabled"])]),_:1}),a(n,{label:"真实姓名",prop:"realName"},{default:o(()=>[a(s,{modelValue:l.realName,"onUpdate:modelValue":e[7]||(e[7]=t=>l.realName=t),placeholder:"请输入真实姓名","prefix-icon":"UserFilled"},null,8,["modelValue"])]),_:1}),a(n,{label:"角色",prop:"role"},{default:o(()=>[a(i,{modelValue:l.role,"onUpdate:modelValue":e[8]||(e[8]=t=>l.role=t),placeholder:"请选择角色",style:{width:"100%"}},{default:o(()=>[a(c,{label:"管理员",value:"admin"}),a(c,{label:"收银员",value:"cashier"}),a(c,{label:"库管员",value:"warehouse"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"手机号",prop:"phone"},{default:o(()=>[a(s,{modelValue:l.phone,"onUpdate:modelValue":e[9]||(e[9]=t=>l.phone=t),placeholder:"请输入手机号","prefix-icon":"Phone"},null,8,["modelValue"])]),_:1}),a(n,{label:"邮箱",prop:"email"},{default:o(()=>[a(s,{modelValue:l.email,"onUpdate:modelValue":e[10]||(e[10]=t=>l.email=t),placeholder:"请输入邮箱","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),b.value==="add"?(k(),A(n,{key:0,label:"密码",prop:"password"},{default:o(()=>[a(s,{modelValue:l.password,"onUpdate:modelValue":e[11]||(e[11]=t=>l.password=t),placeholder:"请输入密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1})):B("",!0),b.value==="add"?(k(),A(n,{key:1,label:"确认密码",prop:"confirmPassword"},{default:o(()=>[a(s,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[12]||(e[12]=t=>l.confirmPassword=t),placeholder:"请再次输入密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1})):B("",!0),a(n,{label:"状态",prop:"status"},{default:o(()=>[a(X,{modelValue:l.statusActive,"onUpdate:modelValue":e[13]||(e[13]=t=>l.statusActive=t),"active-text":"正常","inactive-text":"禁用","active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),fe=oe(me,[["__scopeId","data-v-96c19875"]]);export{fe as default};
