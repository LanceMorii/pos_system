import{d as Y,a as C,r as v,k as Z,c as ee,e as t,w as a,g as n,E as _,o as A,b as V,O as te,h as u,P as ae,D as le,y as F,l as oe,Q as re,A as ne,_ as se}from"./index-DhDhwFZx.js";import{s as h}from"./request-Bb0hX5IM.js";function de(i){return h({url:"/product/list",method:"get",params:i})}function ue(i){return h({url:"/product/add",method:"post",data:i})}function ie(i,c){return h({url:`/product/update/${i}`,method:"put",data:c})}function ce(i){return h({url:`/product/delete/${i}`,method:"delete"})}const pe={class:"product-container"},me={class:"card-header"},_e={class:"search-section"},ge={class:"pagination-section"},fe={class:"dialog-footer"},be=Y({__name:"index",setup(i){const c=C({name:""}),s=C({currentPage:1,pageSize:20,total:0}),k=v([]),g=v(!1),x=v(""),b=v(),l=C({id:"",name:"",code:"",barcode:"",categoryId:1,salePrice:0,purchasePrice:0,currentStock:0,minStock:10,maxStock:1e3,status:"ACTIVE",description:""}),B=C({name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],barcode:[{required:!0,message:"请输入商品条码",trigger:"blur"}],salePrice:[{required:!0,message:"请输入售价",trigger:"blur"}],purchasePrice:[{required:!0,message:"请输入成本价",trigger:"blur"}],currentStock:[{required:!0,message:"请输入库存数量",trigger:"blur"}]}),w=v(!1),y=()=>{b.value&&b.value.resetFields(),Object.assign(l,{id:"",name:"",code:"",barcode:"",categoryId:1,salePrice:0,purchasePrice:0,currentStock:0,minStock:10,maxStock:1e3,status:"ACTIVE",description:""})},f=async()=>{w.value=!0;try{const r={page:s.currentPage,limit:s.pageSize,name:c.name||void 0},e=await de(r);e.code===200?(k.value=e.data.items||[],s.total=e.data.total||0):(_.error(e.message||"获取商品列表失败"),k.value=[],s.total=0)}catch(r){console.error("获取商品列表失败:",r),_.error("获取商品列表失败，请检查网络连接"),k.value=[],s.total=0}finally{w.value=!1}},D=()=>{y(),x.value="新增商品",g.value=!0},$=r=>{y(),x.value="编辑商品",Object.assign(l,{id:r.id,name:r.name,code:r.code,barcode:r.barcode,categoryId:r.categoryId||1,salePrice:r.salePrice||0,purchasePrice:r.purchasePrice||0,currentStock:r.currentStock||0,minStock:r.minStock||10,maxStock:r.maxStock||1e3,status:r.status||"ACTIVE",description:r.description||""}),g.value=!0},q=r=>{ne.confirm(`确认删除商品 "${r.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ce(r.id),_.success("删除成功"),f()}catch(e){console.error("删除商品失败:",e),_.error("删除失败，请重试")}}).catch(()=>{})},N=async()=>{b.value&&await b.value.validate(async r=>{if(r)try{const e={code:l.barcode,name:l.name,categoryId:l.categoryId,barcode:l.barcode,unit:"个",purchasePrice:l.purchasePrice,salePrice:l.salePrice,minStock:l.minStock,maxStock:l.maxStock,currentStock:l.currentStock,status:l.status,description:l.description};l.id?(await ie(l.id,e),_.success("商品修改成功")):(await ue(e),_.success("商品添加成功")),g.value=!1,y(),f()}catch(e){console.error("保存商品失败:",e),_.error("保存失败，请重试")}})},z=()=>{s.currentPage=1,f()},R=()=>{c.name="",z()},j=r=>{s.pageSize=r,s.currentPage=1,f()},L=r=>{s.currentPage=r,f()};return Z(()=>{f()}),(r,e)=>{const M=n("el-icon"),p=n("el-button"),P=n("el-input"),d=n("el-form-item"),E=n("el-form"),m=n("el-table-column"),O=n("el-tag"),Q=n("el-table"),G=n("el-pagination"),H=n("el-card"),I=n("el-input-number"),S=n("el-col"),T=n("el-row"),U=n("el-option"),J=n("el-select"),K=n("el-dialog"),W=ae("loading");return A(),ee("div",pe,[t(H,{shadow:"never"},{header:a(()=>[V("div",me,[e[13]||(e[13]=V("span",null,"商品管理",-1)),t(p,{type:"primary",onClick:D},{default:a(()=>[t(M,null,{default:a(()=>[t(oe(re))]),_:1}),e[12]||(e[12]=u(" 新增商品 "))]),_:1,__:[12]})])]),default:a(()=>[V("div",_e,[t(E,{model:c,inline:""},{default:a(()=>[t(d,{label:"商品名称"},{default:a(()=>[t(P,{modelValue:c.name,"onUpdate:modelValue":e[0]||(e[0]=o=>c.name=o),placeholder:"请输入商品名称",clearable:""},null,8,["modelValue"])]),_:1}),t(d,null,{default:a(()=>[t(p,{type:"primary",onClick:z},{default:a(()=>e[14]||(e[14]=[u("查询")])),_:1,__:[14]}),t(p,{onClick:R},{default:a(()=>e[15]||(e[15]=[u("重置")])),_:1,__:[15]})]),_:1})]),_:1},8,["model"])]),te((A(),le(Q,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[t(m,{prop:"id",label:"商品ID",width:"80"}),t(m,{prop:"name",label:"商品名称","min-width":"150"}),t(m,{prop:"barcode",label:"条码",width:"120"}),t(m,{prop:"salePrice",label:"售价",width:"80"},{default:a(o=>[u(" ¥"+F((o.row.salePrice||0).toFixed(2)),1)]),_:1}),t(m,{prop:"currentStock",label:"库存",width:"80"}),t(m,{prop:"status",label:"状态",width:"80"},{default:a(o=>[t(O,{type:o.row.status==="ACTIVE"?"success":"danger"},{default:a(()=>[u(F(o.row.status==="ACTIVE"?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"操作",width:"180",fixed:"right"},{default:a(o=>[t(p,{type:"primary",size:"small",onClick:X=>$(o.row)},{default:a(()=>e[16]||(e[16]=[u("编辑")])),_:2,__:[16]},1032,["onClick"]),t(p,{type:"danger",size:"small",onClick:X=>q(o.row)},{default:a(()=>e[17]||(e[17]=[u("删除")])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,w.value]]),V("div",ge,[t(G,{"current-page":s.currentPage,"onUpdate:currentPage":e[1]||(e[1]=o=>s.currentPage=o),"page-size":s.pageSize,"onUpdate:pageSize":e[2]||(e[2]=o=>s.pageSize=o),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1}),t(K,{title:x.value,modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=o=>g.value=o),width:"600px",onClose:y},{footer:a(()=>[V("div",fe,[t(p,{onClick:e[10]||(e[10]=o=>g.value=!1)},{default:a(()=>e[18]||(e[18]=[u("取消")])),_:1,__:[18]}),t(p,{type:"primary",onClick:N},{default:a(()=>e[19]||(e[19]=[u("确定")])),_:1,__:[19]})])]),default:a(()=>[t(E,{ref_key:"productFormRef",ref:b,model:l,rules:B,"label-width":"100px"},{default:a(()=>[t(d,{label:"商品名称",prop:"name"},{default:a(()=>[t(P,{modelValue:l.name,"onUpdate:modelValue":e[3]||(e[3]=o=>l.name=o),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),t(d,{label:"商品条码",prop:"barcode"},{default:a(()=>[t(P,{modelValue:l.barcode,"onUpdate:modelValue":e[4]||(e[4]=o=>l.barcode=o),placeholder:"请输入商品条码"},null,8,["modelValue"])]),_:1}),t(T,{gutter:20},{default:a(()=>[t(S,{span:12},{default:a(()=>[t(d,{label:"售价",prop:"salePrice"},{default:a(()=>[t(I,{modelValue:l.salePrice,"onUpdate:modelValue":e[5]||(e[5]=o=>l.salePrice=o),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:12},{default:a(()=>[t(d,{label:"成本价",prop:"purchasePrice"},{default:a(()=>[t(I,{modelValue:l.purchasePrice,"onUpdate:modelValue":e[6]||(e[6]=o=>l.purchasePrice=o),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(T,{gutter:20},{default:a(()=>[t(S,{span:12},{default:a(()=>[t(d,{label:"库存数量",prop:"currentStock"},{default:a(()=>[t(I,{modelValue:l.currentStock,"onUpdate:modelValue":e[7]||(e[7]=o=>l.currentStock=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:12},{default:a(()=>[t(d,{label:"商品状态",prop:"status"},{default:a(()=>[t(J,{modelValue:l.status,"onUpdate:modelValue":e[8]||(e[8]=o=>l.status=o),placeholder:"请选择状态",style:{width:"100%"}},{default:a(()=>[t(U,{label:"上架",value:"ACTIVE"}),t(U,{label:"下架",value:"INACTIVE"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(d,{label:"商品描述"},{default:a(()=>[t(P,{modelValue:l.description,"onUpdate:modelValue":e[9]||(e[9]=o=>l.description=o),type:"textarea",rows:3,placeholder:"请输入商品描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}),ke=se(be,[["__scopeId","data-v-5b1c9688"]]);export{ke as default};
