import{d as B,r as g,a as V,k as h,c as O,e as a,w as l,g as u,o as z,h as f,y as b,b as t,l as M,H as $,E as p,_ as H}from"./index-DhDhwFZx.js";import{u as G,a as J,b as K,c as Q}from"./user-c84Z4Oim.js";import"./request-Bb0hX5IM.js";const W={class:"profile-container"},X={class:"avatar-section"},Y={class:"avatar-container"},Z={class:"avatar-actions"},ee={class:"stats-section"},ae={class:"stat-item"},le={class:"stat-value"},se={class:"stat-item"},oe={class:"stat-value"},te={class:"stat-item"},re={class:"stat-value"},de={class:"dialog-footer"},ne=B({__name:"index",setup(ue){const P=G(),y=g(),_=g(),s=V({id:"",username:"",realName:"",email:"",phone:"",roleName:"",status:1,avatar:"",createdAt:"",lastLoginTime:"",loginCount:0}),d=V({oldPassword:"",newPassword:"",confirmPassword:""}),F=V({realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]}),A=V({oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(i,e,r)=>{e!==d.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]}),N=g(!1),U=g(!1),c=g(!1),L=async()=>{try{const i=await J();i.code===200&&Object.assign(s,i.data)}catch(i){console.error("获取用户信息失败:",i);const e=P.userInfo;Object.assign(s,{id:e.id||"",username:e.username||"",realName:e.realName||"",email:e.email||"",phone:e.phone||"",roleName:e.roleName||"系统管理员",status:e.status||1,avatar:e.avatar||"",createdAt:e.createdAt||new Date().toLocaleString(),lastLoginTime:e.lastLoginTime||"",loginCount:e.loginCount||0})}},R=async()=>{y.value&&await y.value.validate(async i=>{if(i){N.value=!0;try{const e={realName:s.realName,email:s.email,phone:s.phone},r=await K(e);r.code===200?(p.success("个人信息更新成功"),P.updateUserInfo(e)):p.error(r.message||"更新失败")}catch(e){console.error("更新个人信息失败:",e),p.error("更新失败，请重试")}finally{N.value=!1}}})},T=()=>{C(),c.value=!0},q=async()=>{_.value&&await _.value.validate(async i=>{if(i){U.value=!0;try{const e={oldPassword:d.oldPassword,newPassword:d.newPassword},r=await Q(e);r.code===200?(p.success("密码修改成功，请重新登录"),c.value=!1,C(),setTimeout(()=>{P.logout()},2e3)):p.error(r.message||"密码修改失败")}catch(e){console.error("修改密码失败:",e),p.error("修改密码失败，请重试")}finally{U.value=!1}}})},C=()=>{_.value&&_.value.resetFields(),Object.assign(d,{oldPassword:"",newPassword:"",confirmPassword:""})},D=()=>{p.info("头像上传功能开发中...")};return h(()=>{L()}),h(()=>{}),(i,e)=>{const r=u("el-input"),n=u("el-form-item"),m=u("el-col"),v=u("el-row"),E=u("el-tag"),w=u("el-button"),k=u("el-form"),x=u("el-card"),I=u("el-icon"),S=u("el-avatar"),j=u("el-dialog");return z(),O("div",W,[a(v,{gutter:20},{default:l(()=>[a(m,{span:16},{default:l(()=>[a(x,{shadow:"never"},{header:l(()=>e[11]||(e[11]=[t("div",{class:"card-header"},[t("span",null,"个人信息")],-1)])),default:l(()=>[a(k,{ref_key:"profileFormRef",ref:y,model:s,rules:F,"label-width":"100px"},{default:l(()=>[a(v,{gutter:20},{default:l(()=>[a(m,{span:12},{default:l(()=>[a(n,{label:"用户名"},{default:l(()=>[a(r,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=o=>s.username=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{span:12},{default:l(()=>[a(n,{label:"真实姓名",prop:"realName"},{default:l(()=>[a(r,{modelValue:s.realName,"onUpdate:modelValue":e[1]||(e[1]=o=>s.realName=o),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(v,{gutter:20},{default:l(()=>[a(m,{span:12},{default:l(()=>[a(n,{label:"邮箱",prop:"email"},{default:l(()=>[a(r,{modelValue:s.email,"onUpdate:modelValue":e[2]||(e[2]=o=>s.email=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{span:12},{default:l(()=>[a(n,{label:"手机号",prop:"phone"},{default:l(()=>[a(r,{modelValue:s.phone,"onUpdate:modelValue":e[3]||(e[3]=o=>s.phone=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(v,{gutter:20},{default:l(()=>[a(m,{span:12},{default:l(()=>[a(n,{label:"角色"},{default:l(()=>[a(r,{modelValue:s.roleName,"onUpdate:modelValue":e[4]||(e[4]=o=>s.roleName=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{span:12},{default:l(()=>[a(n,{label:"状态"},{default:l(()=>[a(E,{type:s.status===1?"success":"danger"},{default:l(()=>[f(b(s.status===1?"正常":"禁用"),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1}),a(n,{label:"创建时间"},{default:l(()=>[a(r,{modelValue:s.createdAt,"onUpdate:modelValue":e[5]||(e[5]=o=>s.createdAt=o),disabled:""},null,8,["modelValue"])]),_:1}),a(n,null,{default:l(()=>[a(w,{type:"primary",onClick:R,loading:N.value},{default:l(()=>e[12]||(e[12]=[f(" 更新信息 ")])),_:1,__:[12]},8,["loading"]),a(w,{onClick:T},{default:l(()=>e[13]||(e[13]=[f(" 修改密码 ")])),_:1,__:[13]})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1}),a(m,{span:8},{default:l(()=>[a(x,{shadow:"never"},{header:l(()=>e[14]||(e[14]=[t("div",{class:"card-header"},[t("span",null,"用户头像")],-1)])),default:l(()=>[t("div",X,[t("div",Y,[a(S,{size:120,src:s.avatar},{default:l(()=>[a(I,null,{default:l(()=>[a(M($))]),_:1})]),_:1},8,["src"])]),t("div",Z,[a(w,{type:"primary",size:"small",onClick:D},{default:l(()=>e[15]||(e[15]=[f(" 上传头像 ")])),_:1,__:[15]})])])]),_:1}),a(x,{shadow:"never",style:{"margin-top":"20px"}},{header:l(()=>e[16]||(e[16]=[t("div",{class:"card-header"},[t("span",null,"账户统计")],-1)])),default:l(()=>[t("div",ee,[t("div",ae,[e[17]||(e[17]=t("div",{class:"stat-label"},"最后登录",-1)),t("div",le,b(s.lastLoginTime||"暂无记录"),1)]),t("div",se,[e[18]||(e[18]=t("div",{class:"stat-label"},"登录次数",-1)),t("div",oe,b(s.loginCount||0)+" 次",1)]),t("div",te,[e[19]||(e[19]=t("div",{class:"stat-label"},"账户创建",-1)),t("div",re,b(s.createdAt),1)])])]),_:1})]),_:1})]),_:1}),a(j,{title:"修改密码",modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=o=>c.value=o),width:"400px",onClose:C},{footer:l(()=>[t("div",de,[a(w,{onClick:e[9]||(e[9]=o=>c.value=!1)},{default:l(()=>e[20]||(e[20]=[f("取消")])),_:1,__:[20]}),a(w,{type:"primary",onClick:q,loading:U.value},{default:l(()=>e[21]||(e[21]=[f(" 确认修改 ")])),_:1,__:[21]},8,["loading"])])]),default:l(()=>[a(k,{ref_key:"passwordFormRef",ref:_,model:d,rules:A,"label-width":"100px"},{default:l(()=>[a(n,{label:"当前密码",prop:"oldPassword"},{default:l(()=>[a(r,{modelValue:d.oldPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>d.oldPassword=o),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),a(n,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(r,{modelValue:d.newPassword,"onUpdate:modelValue":e[7]||(e[7]=o=>d.newPassword=o),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(n,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(r,{modelValue:d.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=o=>d.confirmPassword=o),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),fe=H(ne,[["__scopeId","data-v-cf12fed8"]]);export{fe as default};
