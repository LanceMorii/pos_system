import{d as ft,i as F,r as y,k as yt,c as h,b as e,e as t,w as a,g as p,o as d,y as u,h as v,l as n,t as R,p as G,B as ht,C as w,D as _,F as M,z as N,G as gt,H as wt,I as bt,n as kt,v as U,J as O,K as $,L as q,u as xt,E as T,M as H,N as J,_ as Ct}from"./index-DhDhwFZx.js";import{u as St}from"./user-c84Z4Oim.js";import{s as Gt}from"./request-Bb0hX5IM.js";const zt={class:"dashboard-container"},At={class:"welcome-section"},Tt={class:"welcome-content"},Dt={class:"welcome-text"},Vt={class:"welcome-actions"},Ft={class:"stat-content"},Mt={class:"stat-icon"},Nt={class:"stat-info"},Ut={class:"stat-value"},Bt={class:"stat-content"},It={class:"stat-icon"},Lt={class:"stat-info"},jt={class:"stat-value"},Et={class:"stat-content"},Pt={class:"stat-icon"},Rt={class:"stat-info"},Ot={class:"stat-value"},$t={class:"stat-content"},qt={class:"stat-icon"},Ht={class:"stat-info"},Jt={class:"stat-value"},Kt={class:"quick-actions"},Qt={class:"action-grid"},Wt={class:"action-icon cashier"},Xt={class:"action-icon product"},Yt={class:"action-icon inventory"},Zt={class:"action-icon member"},te={class:"action-icon inventory"},ee={class:"action-icon supplier"},se={class:"card-header"},ae={class:"recent-activities"},oe={key:0,class:"loading-container"},le={key:1,class:"empty-activities"},ne={key:2,class:"activity-list"},ie={class:"activity-content"},de={class:"activity-text"},re={class:"activity-time"},ce={class:"activities-dialog"},ue={class:"activities-filter"},ve={class:"all-activities-list"},_e={class:"activity-content-dialog"},me={class:"activity-text-dialog"},pe={class:"activity-time-dialog"},fe={class:"activities-pagination"},ye={class:"dialog-footer"},he=ft({__name:"index",setup(ge){const b=xt(),K=St(),B=F(()=>K.userInfo),Q=F(()=>new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})),r=y({sales:0,salesGrowth:0,orders:0,ordersGrowth:0,customers:0,customersGrowth:0,lowStock:0}),z=y([]),A=y(!1),k=y("all"),g=y(1),x=y(20),I=y(0),D=y([]),W=F(()=>{let l=D.value;k.value!=="all"&&(l=l.filter(c=>c.type===k.value)),I.value=l.length;const s=(g.value-1)*x.value,o=s+x.value;return l.slice(s,o)}),L=()=>{b.push("/dashboard/cashier")},X=()=>{b.push("/dashboard/product")},V=()=>{b.push("/dashboard/inventory")},Y=()=>{b.push("/dashboard/member")},Z=()=>{b.push("/dashboard/supplier")},tt=async()=>{A.value=!0,g.value=1,k.value="all",await j()},et=()=>{g.value=1},C=y(!1),st=async()=>{try{const l=await Gt({url:"/test/dashboard-stats",method:"get"});l.code===200?r.value=l.data:r.value={sales:0,salesGrowth:0,orders:0,ordersGrowth:0,customers:0,customersGrowth:0,lowStock:0}}catch(l){console.error("获取今日统计数据失败:",l),r.value={sales:0,salesGrowth:0,orders:0,ordersGrowth:0,customers:0,customersGrowth:0,lowStock:0}}},at=async()=>{try{z.value=[{id:1,type:"sale",text:"收银员张三完成了一笔¥128.50的销售",time:"2分钟前",status:"success"},{id:2,type:"inventory",text:'商品"可口可乐"库存不足，当前库存：5件',time:"15分钟前",status:"warning"},{id:3,type:"member",text:'新会员"李四"注册成功',time:"1小时前",status:"success"},{id:4,type:"system",text:"系统自动备份完成",time:"2小时前",status:"info"}]}catch(l){console.error("获取最新动态失败:",l)}},j=async()=>{try{D.value=[...z.value,{id:5,type:"sale",text:"收银员王五完成了一笔¥89.00的销售",time:"3小时前",status:"success"},{id:6,type:"inventory",text:'商品"薯片"已补货，当前库存：50件',time:"4小时前",status:"success"}]}catch(l){console.error("获取动态数据失败:",l)}},ot=async()=>{C.value=!0;try{await j(),T.success("动态已刷新")}catch{T.error("刷新失败")}finally{C.value=!1}},lt=l=>{x.value=l,g.value=1},nt=l=>{g.value=l},E=l=>{switch(l){case"success":return"成功";case"warning":return"警告";case"info":return"信息";case"error":return"错误";default:return"未知"}},it=()=>{try{const l=D.value.map(m=>({时间:m.time,类型:dt(m.type),内容:m.text,状态:E(m.status)})),s=[["时间","类型","内容","状态"].join(","),...l.map(m=>Object.values(m).join(","))].join(`
`),o=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),f=URL.createObjectURL(o);c.setAttribute("href",f),c.setAttribute("download",`系统动态_${new Date().toISOString().split("T")[0]}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),T.success("动态记录导出成功")}catch(l){console.error("导出失败:",l),T.error("导出失败，请重试")}},dt=l=>{switch(l){case"sale":return"销售";case"inventory":return"库存";case"member":return"会员";case"system":return"系统";default:return"其他"}},rt=async()=>{C.value=!0;try{await Promise.all([st(),at()])}catch(l){console.error("初始化数据加载失败:",l)}finally{C.value=!1}};return yt(()=>{console.log("Dashboard mounted"),rt()}),(l,s)=>{const o=p("el-icon"),c=p("el-button"),f=p("el-card"),m=p("el-col"),P=p("el-row"),ct=p("Sell"),ut=p("el-empty"),S=p("el-radio-button"),vt=p("el-radio-group"),_t=p("el-scrollbar"),mt=p("el-pagination"),pt=p("el-dialog");return d(),h("div",zt,[e("div",At,[t(f,{shadow:"never",class:"welcome-card"},{default:a(()=>[e("div",Tt,[e("div",Dt,[e("h2",null,"欢迎回来，"+u(B.value.realName||B.value.username)+"！",1),e("p",null,"今天是 "+u(Q.value)+"，祝您工作愉快",1)]),e("div",Vt,[t(c,{type:"primary",onClick:L},{default:a(()=>[t(o,null,{default:a(()=>[t(n(R))]),_:1}),s[5]||(s[5]=v(" 快速收银 "))]),_:1,__:[5]}),t(c,{onClick:V},{default:a(()=>[t(o,null,{default:a(()=>[t(n(G))]),_:1}),s[6]||(s[6]=v(" 库存管理 "))]),_:1,__:[6]})])])]),_:1})]),t(P,{gutter:20,class:"overview-section"},{default:a(()=>[t(m,{span:6},{default:a(()=>[t(f,{shadow:"hover",class:"stat-card today-sales"},{default:a(()=>[e("div",Ft,[e("div",Mt,[t(o,null,{default:a(()=>[t(n(ht))]),_:1})]),e("div",Nt,[e("div",Ut,"¥"+u(Number(r.value.sales||0).toLocaleString()),1),s[7]||(s[7]=e("div",{class:"stat-label"},"今日销售额",-1)),e("div",{class:w(["stat-change",r.value.salesGrowth>=0?"positive":"negative"])},[r.value.salesGrowth>=0?(d(),_(o,{key:0},{default:a(()=>[t(n(M))]),_:1})):(d(),_(o,{key:1},{default:a(()=>[t(n(N))]),_:1})),v(" "+u(Math.abs(r.value.salesGrowth||0).toFixed(1))+"% ",1)],2)])])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(f,{shadow:"hover",class:"stat-card today-orders"},{default:a(()=>[e("div",Bt,[e("div",It,[t(o,null,{default:a(()=>[t(n(gt))]),_:1})]),e("div",Lt,[e("div",jt,u(r.value.orders),1),s[8]||(s[8]=e("div",{class:"stat-label"},"今日订单数",-1)),e("div",{class:w(["stat-change",r.value.ordersGrowth>=0?"positive":"negative"])},[r.value.ordersGrowth>=0?(d(),_(o,{key:0},{default:a(()=>[t(n(M))]),_:1})):(d(),_(o,{key:1},{default:a(()=>[t(n(N))]),_:1})),v(" "+u(Math.abs(r.value.ordersGrowth||0).toFixed(1))+"% ",1)],2)])])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(f,{shadow:"hover",class:"stat-card today-customers"},{default:a(()=>[e("div",Et,[e("div",Pt,[t(o,null,{default:a(()=>[t(n(wt))]),_:1})]),e("div",Rt,[e("div",Ot,u(r.value.customers),1),s[9]||(s[9]=e("div",{class:"stat-label"},"今日客流量",-1)),e("div",{class:w(["stat-change",r.value.customersGrowth>=0?"positive":"negative"])},[r.value.customersGrowth>=0?(d(),_(o,{key:0},{default:a(()=>[t(n(M))]),_:1})):(d(),_(o,{key:1},{default:a(()=>[t(n(N))]),_:1})),v(" "+u(Math.abs(r.value.customersGrowth||0).toFixed(1))+"% ",1)],2)])])]),_:1})]),_:1}),t(m,{span:6},{default:a(()=>[t(f,{shadow:"hover",class:"stat-card inventory-alert"},{default:a(()=>[e("div",$t,[e("div",qt,[t(o,null,{default:a(()=>[t(n(bt))]),_:1})]),e("div",Ht,[e("div",Jt,u(r.value.lowStock),1),s[10]||(s[10]=e("div",{class:"stat-label"},"库存预警",-1)),s[11]||(s[11]=e("div",{class:"stat-change"},[e("span",null,"需要补货")],-1))])])]),_:1})]),_:1})]),_:1}),t(P,{gutter:20,class:"content-section"},{default:a(()=>[t(m,{span:12},{default:a(()=>[t(f,{shadow:"never"},{header:a(()=>s[12]||(s[12]=[e("div",{class:"card-header"},[e("span",null,"快捷操作")],-1)])),default:a(()=>[e("div",Kt,[e("div",Qt,[e("div",{class:"action-item",onClick:L},[e("div",Wt,[t(o,null,{default:a(()=>[t(n(R))]),_:1})]),s[13]||(s[13]=e("div",{class:"action-text"},"收银台",-1))]),e("div",{class:"action-item",onClick:X},[e("div",Xt,[t(o,null,{default:a(()=>[t(n(kt))]),_:1})]),s[14]||(s[14]=e("div",{class:"action-text"},"商品管理",-1))]),e("div",{class:"action-item",onClick:V},[e("div",Yt,[t(o,null,{default:a(()=>[t(n(G))]),_:1})]),s[15]||(s[15]=e("div",{class:"action-text"},"库存管理",-1))]),e("div",{class:"action-item",onClick:Y},[e("div",Zt,[t(o,null,{default:a(()=>[t(n(U))]),_:1})]),s[16]||(s[16]=e("div",{class:"action-text"},"会员管理",-1))]),e("div",{class:"action-item",onClick:V},[e("div",te,[t(o,null,{default:a(()=>[t(n(G))]),_:1})]),s[17]||(s[17]=e("div",{class:"action-text"},"库存管理",-1))]),e("div",{class:"action-item",onClick:Z},[e("div",ee,[t(o,null,{default:a(()=>[t(ct)]),_:1})]),s[18]||(s[18]=e("div",{class:"action-text"},"供应商管理",-1))])])])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(f,{shadow:"never"},{header:a(()=>[e("div",se,[s[20]||(s[20]=e("span",null,"最新动态",-1)),t(c,{link:"",size:"small",onClick:tt},{default:a(()=>s[19]||(s[19]=[v("查看更多")])),_:1,__:[19]})])]),default:a(()=>[e("div",ae,[C.value?(d(),h("div",oe,[t(o,{class:"is-loading"},{default:a(()=>[t(n(O))]),_:1}),s[21]||(s[21]=e("span",null,"加载中...",-1))])):z.value.length===0?(d(),h("div",le,[t(ut,{description:"暂无最新动态","image-size":60})])):(d(),h("div",ne,[(d(!0),h($,null,q(z.value,i=>(d(),h("div",{key:i.id,class:"activity-item"},[e("div",{class:w(["activity-icon",i.type])},[i.type==="sale"?(d(),_(o,{key:0},{default:a(()=>[t(n(H))]),_:1})):i.type==="inventory"?(d(),_(o,{key:1},{default:a(()=>[t(n(G))]),_:1})):i.type==="member"?(d(),_(o,{key:2},{default:a(()=>[t(n(U))]),_:1})):(d(),_(o,{key:3},{default:a(()=>[t(n(J))]),_:1}))],2),e("div",ie,[e("div",de,u(i.text),1),e("div",re,u(i.time),1)])]))),128))]))])]),_:1})]),_:1})]),_:1}),t(pt,{title:"系统动态",modelValue:A.value,"onUpdate:modelValue":s[4]||(s[4]=i=>A.value=i),width:"800px",top:"5vh"},{footer:a(()=>[e("div",ye,[t(c,{onClick:s[3]||(s[3]=i=>A.value=!1)},{default:a(()=>s[28]||(s[28]=[v("关闭")])),_:1,__:[28]}),t(c,{type:"primary",onClick:it},{default:a(()=>s[29]||(s[29]=[v("导出记录")])),_:1,__:[29]})])]),default:a(()=>[e("div",ce,[e("div",ue,[t(vt,{modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=i=>k.value=i),size:"small",onChange:et},{default:a(()=>[t(S,{label:"all"},{default:a(()=>s[22]||(s[22]=[v("全部")])),_:1,__:[22]}),t(S,{label:"sale"},{default:a(()=>s[23]||(s[23]=[v("销售")])),_:1,__:[23]}),t(S,{label:"inventory"},{default:a(()=>s[24]||(s[24]=[v("库存")])),_:1,__:[24]}),t(S,{label:"member"},{default:a(()=>s[25]||(s[25]=[v("会员")])),_:1,__:[25]}),t(S,{label:"system"},{default:a(()=>s[26]||(s[26]=[v("系统")])),_:1,__:[26]})]),_:1},8,["modelValue"]),t(c,{type:"primary",size:"small",onClick:ot,style:{"margin-left":"10px"}},{default:a(()=>[t(o,null,{default:a(()=>[t(n(O))]),_:1}),s[27]||(s[27]=v(" 刷新 "))]),_:1,__:[27]})]),t(_t,{height:"400px",class:"activities-scrollbar"},{default:a(()=>[e("div",ve,[(d(!0),h($,null,q(W.value,i=>(d(),h("div",{key:i.id,class:"activity-item-dialog"},[e("div",{class:w(["activity-icon-dialog",i.type])},[i.type==="sale"?(d(),_(o,{key:0},{default:a(()=>[t(n(H))]),_:1})):i.type==="inventory"?(d(),_(o,{key:1},{default:a(()=>[t(n(G))]),_:1})):i.type==="member"?(d(),_(o,{key:2},{default:a(()=>[t(n(U))]),_:1})):(d(),_(o,{key:3},{default:a(()=>[t(n(J))]),_:1}))],2),e("div",_e,[e("div",me,u(i.text),1),e("div",pe,u(i.time),1)]),e("div",{class:w(["activity-status",i.status])},u(E(i.status)),3)]))),128))])]),_:1}),e("div",fe,[t(mt,{"current-page":g.value,"onUpdate:currentPage":s[1]||(s[1]=i=>g.value=i),"page-size":x.value,"onUpdate:pageSize":s[2]||(s[2]=i=>x.value=i),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",total:I.value,onSizeChange:lt,onCurrentChange:nt,small:""},null,8,["current-page","page-size","total"])])])]),_:1},8,["modelValue"])])}}}),xe=Ct(he,[["__scopeId","data-v-5ea11ba1"]]);export{xe as default};
