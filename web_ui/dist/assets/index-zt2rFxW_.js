import{d as Pe,a as V,r as b,k as Ue,c as ze,e as t,w as a,g as c,o as B,b as y,O as Z,h as d,P as he,D as ee,y as S,C as te,l as le,Q as ae,E as k,_ as xe}from"./index-DhDhwFZx.js";import{s as D}from"./request-Bb0hX5IM.js";function Ne(_){return D({url:"/inventory/list",method:"get",params:_})}function qe(_){return D({url:"/inventory/stock-in",method:"post",data:_})}function Re(_){return D({url:"/inventory/stock-out",method:"post",data:_})}function Fe(_,v){return D({url:`/inventory/records/${_}`,method:"get",params:v})}const Oe={class:"inventory-container"},Te={class:"card-header"},De={class:"search-section"},$e={class:"pagination-section"},Ae={class:"dialog-footer"},Ye={class:"record-filters"},Le={class:"record-pagination"},je={class:"dialog-footer"},Me={class:"dialog-footer"},Be=Pe({__name:"index",setup(_){const v=V({name:"",stockStatus:""}),f=V({currentPage:1,pageSize:20,total:0}),$=b([{id:"1",name:"有机鲜牛奶 1L",barcode:"6901234567890",category:"生鲜果蔬",currentStock:50,minStock:10,maxStock:200,unit:"瓶",lastUpdateTime:"2024-01-15 10:30:00"},{id:"2",name:"面包新语吐司",barcode:"6901234567891",category:"休闲零食",currentStock:5,minStock:10,maxStock:100,unit:"个",lastUpdateTime:"2024-01-15 09:15:00"},{id:"3",name:"特级橙子 500g",barcode:"6901234567892",category:"生鲜果蔬",currentStock:0,minStock:20,maxStock:150,unit:"袋",lastUpdateTime:"2024-01-14 16:45:00"}]),P=b(!1),U=b(!1),N=b(!1),z=b(),h=b(),r=V({productId:"",productName:"",currentStock:0,quantity:1,type:"purchase",supplier:"",unitPrice:0,remark:""}),n=V({productId:"",productName:"",currentStock:0,quantity:1,type:"sale",unitPrice:0,reason:""}),oe=V({quantity:[{required:!0,message:"请输入入库数量",trigger:"blur"}],type:[{required:!0,message:"请选择入库类型",trigger:"change"}]}),re=V({quantity:[{required:!0,message:"请输入出库数量",trigger:"blur"}],type:[{required:!0,message:"请选择出库类型",trigger:"change"}],reason:[{required:!0,message:"请输入出库原因",trigger:"blur"}]}),A=b(!1),E=b(""),q=b(""),R=b([]),Y=b(!1),m=V({type:"",dateRange:[]}),i=V({currentPage:1,pageSize:10,total:0}),ne=o=>o.currentStock===0?"stock-danger":o.currentStock<=o.minStock?"stock-warning":"",ue=o=>o.currentStock===0?"danger":o.currentStock<=o.minStock?"warning":"success",de=o=>o.currentStock===0?"缺货":o.currentStock<=o.minStock?"预警":"正常",C=async()=>{A.value=!0;try{const o={page:f.currentPage,limit:f.pageSize,name:v.name||void 0,stockStatus:v.stockStatus||void 0},e=await Ne(o);e.code===200&&($.value=e.data.items,f.total=e.data.total)}catch(o){console.error("获取库存列表失败:",o),f.total=$.value.length}finally{A.value=!1}},Q=()=>{f.currentPage=1,C()},se=()=>{v.name="",v.stockStatus="",Q()},ie=o=>{f.pageSize=o,f.currentPage=1,C()},pe=o=>{f.currentPage=o,C()},ce=()=>{k.info("请选择要入库的商品")},me=o=>{L(),r.productId=o.id,r.productName=o.name,r.currentStock=o.currentStock,P.value=!0},ge=()=>{k.info("请选择要出库的商品")},fe=o=>{if(o.currentStock<=0){k.warning("该商品库存不足，无法出库");return}j(),n.productId=o.id,n.productName=o.name,n.currentStock=o.currentStock,U.value=!0},ke=o=>{E.value=o.name,q.value=o.id,N.value=!0,G(),x()},L=()=>{z.value&&z.value.resetFields(),Object.assign(r,{productId:"",productName:"",currentStock:0,quantity:1,type:"purchase",supplier:"",unitPrice:0,remark:""})},j=()=>{h.value&&h.value.resetFields(),Object.assign(n,{productId:"",productName:"",currentStock:0,quantity:1,type:"sale",unitPrice:0,reason:""})},ye=async()=>{z.value&&await z.value.validate(async o=>{if(o)try{const e={productId:parseInt(r.productId),quantity:parseInt(r.quantity),type:r.type.toUpperCase(),unitPrice:parseFloat(r.unitPrice),remark:r.remark||""};r.supplier&&(e.supplierId=null),console.log("发送入库数据:",e);const I=await qe(e);console.log("入库响应:",I),k.success("入库成功"),P.value=!1,L(),C()}catch(e){console.error("入库失败:",e),e.response&&e.response.data&&e.response.data.message?k.error(`入库失败: ${e.response.data.message}`):e.message?k.error(`入库失败: ${e.message}`):k.error("入库失败，请重试")}})},ve=async()=>{h.value&&await h.value.validate(async o=>{if(o)try{const e={productId:parseInt(n.productId),quantity:parseInt(n.quantity),type:n.type.toUpperCase(),unitPrice:parseFloat(n.unitPrice)||0,reason:n.reason||"出库操作",remark:n.reason||""};console.log("发送出库数据:",e);const I=await Re(e);console.log("出库响应:",I),k.success("出库成功"),U.value=!1,j(),C()}catch(e){console.error("出库失败:",e),e.response&&e.response.data&&e.response.data.message?k.error(`出库失败: ${e.response.data.message}`):e.message?k.error(`出库失败: ${e.message}`):k.error("出库失败，请重试")}})},x=async()=>{if(q.value){Y.value=!0;try{const o={page:i.currentPage,limit:i.pageSize,type:m.type||void 0};m.dateRange&&m.dateRange.length===2&&(o.startTime=m.dateRange[0]+" 00:00:00",o.endTime=m.dateRange[1]+" 23:59:59"),console.log("获取库存记录参数:",{productId:q.value,params:o});const e=await Fe(parseInt(q.value),o);e.code===200?(R.value=e.data.items||[],i.total=e.data.total||0,console.log("库存记录响应:",e.data)):k.error(e.message||"获取库存记录失败")}catch(o){console.error("获取库存记录失败:",o),k.error("获取库存记录失败");const e=[{id:1,recordNo:"IN20250127001",createdAt:"2025-01-27 10:30:00",type:"IN",subType:"采购入库",quantity:100,unitPrice:12.5,totalAmount:1250,beforeStock:50,afterStock:150,operatorName:"张三",remark:"新批次采购入库"},{id:2,recordNo:"OUT20250127001",createdAt:"2025-01-27 14:20:00",type:"OUT",subType:"销售出库",quantity:20,unitPrice:0,totalAmount:0,beforeStock:150,afterStock:130,operatorName:"李四",remark:"销售出库"}];R.value=e,i.total=e.length}finally{Y.value=!1}}},G=()=>{m.type="",m.dateRange=[],i.currentPage=1,i.pageSize=10,i.total=0,R.value=[]},be=()=>{i.currentPage=1,x()},Se=()=>{m.type="",m.dateRange=[],i.currentPage=1,x()},_e=o=>{i.pageSize=o,i.currentPage=1,x()},we=o=>{i.currentPage=o,x()},Ve=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"";return Ue(()=>{C()}),(o,e)=>{const I=c("el-icon"),g=c("el-button"),w=c("el-input"),s=c("el-form-item"),p=c("el-option"),F=c("el-select"),O=c("el-form"),u=c("el-table-column"),H=c("el-tag"),J=c("el-table"),K=c("el-pagination"),Ce=c("el-card"),T=c("el-input-number"),M=c("el-dialog"),Ie=c("el-date-picker"),W=he("loading");return B(),ze("div",Oe,[t(Ce,{shadow:"never"},{header:a(()=>[y("div",Te,[e[29]||(e[29]=y("span",null,"库存管理",-1)),y("div",null,[t(g,{type:"primary",onClick:ce},{default:a(()=>[t(I,null,{default:a(()=>[t(le(ae))]),_:1}),e[27]||(e[27]=d(" 入库 "))]),_:1,__:[27]}),t(g,{type:"warning",onClick:ge},{default:a(()=>[t(I,null,{default:a(()=>[t(le(ae))]),_:1}),e[28]||(e[28]=d(" 出库 "))]),_:1,__:[28]})])])]),default:a(()=>[y("div",De,[t(O,{model:v,inline:""},{default:a(()=>[t(s,{label:"商品名称"},{default:a(()=>[t(w,{modelValue:v.name,"onUpdate:modelValue":e[0]||(e[0]=l=>v.name=l),placeholder:"请输入商品名称",clearable:""},null,8,["modelValue"])]),_:1}),t(s,{label:"库存状态"},{default:a(()=>[t(F,{modelValue:v.stockStatus,"onUpdate:modelValue":e[1]||(e[1]=l=>v.stockStatus=l),placeholder:"请选择库存状态",clearable:""},{default:a(()=>[t(p,{label:"全部",value:""}),t(p,{label:"正常",value:"normal"}),t(p,{label:"预警",value:"warning"}),t(p,{label:"缺货",value:"shortage"})]),_:1},8,["modelValue"])]),_:1}),t(s,null,{default:a(()=>[t(g,{type:"primary",onClick:Q},{default:a(()=>e[30]||(e[30]=[d("查询")])),_:1,__:[30]}),t(g,{onClick:se},{default:a(()=>e[31]||(e[31]=[d("重置")])),_:1,__:[31]})]),_:1})]),_:1},8,["model"])]),Z((B(),ee(J,{data:$.value,border:"",style:{width:"100%"}},{default:a(()=>[t(u,{prop:"id",label:"商品ID",width:"80"}),t(u,{prop:"name",label:"商品名称","min-width":"150"}),t(u,{prop:"barcode",label:"条码",width:"120"}),t(u,{prop:"category",label:"分类",width:"100"}),t(u,{prop:"currentStock",label:"当前库存",width:"100"},{default:a(l=>[y("span",{class:te(ne(l.row))},S(l.row.currentStock),3)]),_:1}),t(u,{prop:"minStock",label:"最低库存",width:"100"}),t(u,{prop:"maxStock",label:"最高库存",width:"100"}),t(u,{prop:"unit",label:"单位",width:"60"}),t(u,{label:"库存状态",width:"100"},{default:a(l=>[t(H,{type:ue(l.row)},{default:a(()=>[d(S(de(l.row)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"lastUpdateTime",label:"最后更新",width:"150"}),t(u,{label:"操作",width:"200",fixed:"right"},{default:a(l=>[t(g,{type:"primary",size:"small",onClick:X=>me(l.row)},{default:a(()=>e[32]||(e[32]=[d("入库")])),_:2,__:[32]},1032,["onClick"]),t(g,{type:"warning",size:"small",onClick:X=>fe(l.row)},{default:a(()=>e[33]||(e[33]=[d("出库")])),_:2,__:[33]},1032,["onClick"]),t(g,{type:"info",size:"small",onClick:X=>ke(l.row)},{default:a(()=>e[34]||(e[34]=[d("记录")])),_:2,__:[34]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,A.value]]),y("div",$e,[t(K,{"current-page":f.currentPage,"onUpdate:currentPage":e[2]||(e[2]=l=>f.currentPage=l),"page-size":f.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>f.pageSize=l),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ie,onCurrentChange:pe},null,8,["current-page","page-size","total"])])]),_:1}),t(M,{title:"商品入库",modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=l=>P.value=l),width:"500px",onClose:L},{footer:a(()=>[y("div",Ae,[t(g,{onClick:e[11]||(e[11]=l=>P.value=!1)},{default:a(()=>e[35]||(e[35]=[d("取消")])),_:1,__:[35]}),t(g,{type:"primary",onClick:ye},{default:a(()=>e[36]||(e[36]=[d("确认入库")])),_:1,__:[36]})])]),default:a(()=>[t(O,{ref_key:"stockInFormRef",ref:z,model:r,rules:oe,"label-width":"100px"},{default:a(()=>[t(s,{label:"商品名称"},{default:a(()=>[t(w,{modelValue:r.productName,"onUpdate:modelValue":e[4]||(e[4]=l=>r.productName=l),disabled:""},null,8,["modelValue"])]),_:1}),t(s,{label:"当前库存"},{default:a(()=>[t(w,{modelValue:r.currentStock,"onUpdate:modelValue":e[5]||(e[5]=l=>r.currentStock=l),disabled:""},null,8,["modelValue"])]),_:1}),t(s,{label:"入库数量",prop:"quantity"},{default:a(()=>[t(T,{modelValue:r.quantity,"onUpdate:modelValue":e[6]||(e[6]=l=>r.quantity=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(s,{label:"入库类型",prop:"type"},{default:a(()=>[t(F,{modelValue:r.type,"onUpdate:modelValue":e[7]||(e[7]=l=>r.type=l),placeholder:"请选择入库类型",style:{width:"100%"}},{default:a(()=>[t(p,{label:"采购入库",value:"purchase"}),t(p,{label:"退货入库",value:"return"}),t(p,{label:"调拨入库",value:"transfer"}),t(p,{label:"盘点调整",value:"adjustment"})]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"供应商"},{default:a(()=>[t(w,{modelValue:r.supplier,"onUpdate:modelValue":e[8]||(e[8]=l=>r.supplier=l),placeholder:"请输入供应商"},null,8,["modelValue"])]),_:1}),t(s,{label:"单价"},{default:a(()=>[t(T,{modelValue:r.unitPrice,"onUpdate:modelValue":e[9]||(e[9]=l=>r.unitPrice=l),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(s,{label:"备注"},{default:a(()=>[t(w,{modelValue:r.remark,"onUpdate:modelValue":e[10]||(e[10]=l=>r.remark=l),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(M,{title:`${E.value} - 库存记录`,modelValue:N.value,"onUpdate:modelValue":e[18]||(e[18]=l=>N.value=l),width:"900px",onClose:G},{footer:a(()=>[y("div",je,[t(g,{onClick:e[17]||(e[17]=l=>N.value=!1)},{default:a(()=>e[39]||(e[39]=[d("关闭")])),_:1,__:[39]})])]),default:a(()=>[y("div",Ye,[t(O,{model:m,inline:""},{default:a(()=>[t(s,{label:"记录类型"},{default:a(()=>[t(F,{modelValue:m.type,"onUpdate:modelValue":e[13]||(e[13]=l=>m.type=l),placeholder:"全部类型",clearable:"",style:{width:"120px"}},{default:a(()=>[t(p,{label:"全部",value:""}),t(p,{label:"入库",value:"IN"}),t(p,{label:"出库",value:"OUT"})]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"时间范围"},{default:a(()=>[t(Ie,{modelValue:m.dateRange,"onUpdate:modelValue":e[14]||(e[14]=l=>m.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(s,null,{default:a(()=>[t(g,{type:"primary",onClick:be},{default:a(()=>e[37]||(e[37]=[d("查询")])),_:1,__:[37]}),t(g,{onClick:Se},{default:a(()=>e[38]||(e[38]=[d("重置")])),_:1,__:[38]})]),_:1})]),_:1},8,["model"])]),Z((B(),ee(J,{data:R.value,border:"",style:{width:"100%"},"max-height":"400"},{default:a(()=>[t(u,{prop:"recordNo",label:"单据号",width:"140"}),t(u,{prop:"createdAt",label:"操作时间",width:"150"},{default:a(l=>[d(S(Ve(l.row.createdAt)),1)]),_:1}),t(u,{prop:"type",label:"类型",width:"80"},{default:a(l=>[t(H,{type:l.row.type==="IN"?"success":"warning"},{default:a(()=>[d(S(l.row.type==="IN"?"入库":"出库"),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"subType",label:"具体类型",width:"100"}),t(u,{prop:"quantity",label:"数量",width:"80"},{default:a(l=>[y("span",{class:te(l.row.type==="IN"?"quantity-in":"quantity-out")},S(l.row.type==="IN"?"+":"-")+S(l.row.quantity),3)]),_:1}),t(u,{prop:"unitPrice",label:"单价",width:"80"},{default:a(l=>[d(" ¥"+S(l.row.unitPrice?l.row.unitPrice.toFixed(2):"0.00"),1)]),_:1}),t(u,{prop:"totalAmount",label:"总金额",width:"100"},{default:a(l=>[d(" ¥"+S(l.row.totalAmount?l.row.totalAmount.toFixed(2):"0.00"),1)]),_:1}),t(u,{prop:"beforeStock",label:"变动前库存",width:"100"},{default:a(l=>[d(S(l.row.beforeStock!==null&&l.row.beforeStock!==void 0?l.row.beforeStock:"-"),1)]),_:1}),t(u,{prop:"afterStock",label:"变动后库存",width:"100"},{default:a(l=>[d(S(l.row.afterStock!==null&&l.row.afterStock!==void 0?l.row.afterStock:"-"),1)]),_:1}),t(u,{prop:"operatorName",label:"操作员",width:"80"}),t(u,{prop:"remark",label:"备注","min-width":"120","show-overflow-tooltip":""})]),_:1},8,["data"])),[[W,Y.value]]),y("div",Le,[t(K,{"current-page":i.currentPage,"onUpdate:currentPage":e[15]||(e[15]=l=>i.currentPage=l),"page-size":i.pageSize,"onUpdate:pageSize":e[16]||(e[16]=l=>i.pageSize=l),"page-sizes":[10,20,50],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_e,onCurrentChange:we},null,8,["current-page","page-size","total"])])]),_:1},8,["title","modelValue"]),t(M,{title:"商品出库",modelValue:U.value,"onUpdate:modelValue":e[26]||(e[26]=l=>U.value=l),width:"500px",onClose:j},{footer:a(()=>[y("div",Me,[t(g,{onClick:e[25]||(e[25]=l=>U.value=!1)},{default:a(()=>e[40]||(e[40]=[d("取消")])),_:1,__:[40]}),t(g,{type:"primary",onClick:ve},{default:a(()=>e[41]||(e[41]=[d("确认出库")])),_:1,__:[41]})])]),default:a(()=>[t(O,{ref_key:"stockOutFormRef",ref:h,model:n,rules:re,"label-width":"100px"},{default:a(()=>[t(s,{label:"商品名称"},{default:a(()=>[t(w,{modelValue:n.productName,"onUpdate:modelValue":e[19]||(e[19]=l=>n.productName=l),disabled:""},null,8,["modelValue"])]),_:1}),t(s,{label:"当前库存"},{default:a(()=>[t(w,{modelValue:n.currentStock,"onUpdate:modelValue":e[20]||(e[20]=l=>n.currentStock=l),disabled:""},null,8,["modelValue"])]),_:1}),t(s,{label:"出库数量",prop:"quantity"},{default:a(()=>[t(T,{modelValue:n.quantity,"onUpdate:modelValue":e[21]||(e[21]=l=>n.quantity=l),min:1,max:n.currentStock,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1}),t(s,{label:"出库类型",prop:"type"},{default:a(()=>[t(F,{modelValue:n.type,"onUpdate:modelValue":e[22]||(e[22]=l=>n.type=l),placeholder:"请选择出库类型",style:{width:"100%"}},{default:a(()=>[t(p,{label:"销售出库",value:"sale"}),t(p,{label:"损耗出库",value:"loss"}),t(p,{label:"调拨出库",value:"transfer"}),t(p,{label:"盘点调整",value:"adjustment"})]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"单价"},{default:a(()=>[t(T,{modelValue:n.unitPrice,"onUpdate:modelValue":e[23]||(e[23]=l=>n.unitPrice=l),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(s,{label:"出库原因",prop:"reason"},{default:a(()=>[t(w,{modelValue:n.reason,"onUpdate:modelValue":e[24]||(e[24]=l=>n.reason=l),type:"textarea",rows:3,placeholder:"请输入出库原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),Ge=xe(Be,[["__scopeId","data-v-2fb648a3"]]);export{Ge as default};
